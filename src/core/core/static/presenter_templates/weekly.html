<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <style>
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }
        body {
            padding: 0;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            text-align: left;
            background-color: #fff;
        }
        table {
            border-collapse: collapse;
        }
        th {
            text-align: inherit;
        }
        input[type=checkbox] {
            box-sizing: border-box;
            padding: 0
        }
        h1 {
            border-bottom: solid 1px grey;
        }
        input {
            font-size: 1rem;
            line-height: 1.5;
            border: 1px solid rgba(0,0,0,.15);
            border-radius: 0;
            outline: 0;
            background-color: transparent
        }
        [tabindex="-1"]:focus:not(:focus-visible) {
            outline: 0 !important;
        }
        .container {
            width: 100%;
            padding-right: 15px;
            padding-left: 15px;
            margin-right: auto;
            margin-left: auto;
        }
        @media (min-width: 576px) {
            .container {
                max-width: 540px;
            }
        }
        @media (min-width: 768px) {
            .container {
                max-width: 720px;
            }
        }
        @media (min-width: 992px) {
            .container {
                max-width: 960px;
            }
        }
        @media (min-width: 1200px) {
            .container {
                max-width: 1140px;
            }
        }
        .table {
            width: 100%;
            margin-bottom: 1rem;
            color: #212529;
        }
        .table th,
        .table td {
            padding: 0.75rem;
            vertical-align: top;
            border-top: 1px solid #dee2e6;
        }
        .table thead th {
            vertical-align: bottom;
            border-bottom: 2px solid #dee2e6;
        }
        .table tbody + tbody {
            border-top: 2px solid #dee2e6;
        }
        .table-sm th,
        .table-sm td {
            padding: 0.3rem;
        }
        .table-bordered {
            border: 1px solid #dee2e6;
        }
        .table-bordered th,
        .table-bordered td {
            border: 1px solid #dee2e6;
        }
        .table-bordered thead th,
        .table-bordered thead td {
            border-bottom-width: 2px;
        }
        .table-borderless th,
        .table-borderless td,
        .table-borderless thead th,
        .table-borderless tbody + tbody {
            border: 0;
        }
        .text-center {
            text-align: center !important;
        }
        .text-justify {
            text-align: justify !important;
        }
        .text-right {
            text-align: right !important;
        }
        .text-center {
            text-align: center !important;
        }
        .text-bold {
            font-weight: 700
        }
        .align-middle {
            vertical-align: middle !important;
        }
        .py-0 {
            padding-top: 0 !important;
        }
        .mt-2 {
            margin-top: 0.5rem !important;
        }
        .title {
            font-size: 20px;
            font-weight: 700
        }
        .number {
            text-align: right;
            font-size: 12px
        }
        .w20 {
            width: 20%
        }
         .header_info {
             font-size: 12px
         }
        .w15 {
            width: 15%
        }
        .cvss {
            color: red;
            font-weight: 700
        }
        .cvss_left {
            padding-left: 8px;
        }
        .bold {
            font-weight: 700
        }
        .th_data {
            background-color: #BFD5ED;
            font-size: 12px;
            font-weight: 700
        }
        .text_in_tab {
            font-size: 14px
        }
        .checkbox-button__input {
            opacity: 0;
            position: absolute
        }
        .checkbox-button__control {
            position: relative;
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 5px;
            margin-left: 5px;
            vertical-align: middle;
            background-color: inherit;
            border: 1px solid gray
        }
        .checkbox-button__input:checked+.checkbox-button__control:after {
            content: "";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 11px;
            height: 11px;
            background-color: black
        }
        .checkbox-button__input:checked+.checkbox-button__control {
            border-color: gray
        }
        .checkbox-button__control {
            transform: scale(0.75)
        }
        .footer_text {
            font-size: 12px
        }
        .footer_color {
            background-color: lightgray
        }
        .w30 {
            width: 30%
        }
        td.text_in_footer_table {
            padding: 5px 15px 5px 15px
        }

    </style>
</head>
<body>
<div class="container">

    <div>
        <table class="table table-borderless">
            <tr>
                <td class="w20">
                    <img src="https://github.com/taranis-ai/taranis-ai/blob/master/resources/images/logo.png?raw=true">
                </td>
                <td class="w60 text-center align-middle title">WEEKLY SUMMARY</td>
                <td class="w20 number">{{ data.product.title }}</td>
            </tr>
        </table>
        <br>
    </div>

    <h1>Summary</h1>

    <p>{{ data.product.description }}</p>

    <p>In this week, we reported {{ data.report_items | selectattr("type", "equalto", "Vulnerability Report") | list | length }} vulnerabilities:</p>
    <ul>
        {% for report_item in data.report_items %}
            {% if report_item.type == "Vulnerability Report" %}
                <li><a href="#vuln-{{ loop.index }}">{{ report_item.name | e }}</a></li>
            {% endif %}
        {% endfor %}
    </ul>

    {% set available_sectors = (data.report_items | selectattr("type", "equalto", "News by Sector") | map(attribute='attributes.nis_sector') | map('string') | unique | list ) %}

    <p>We also published {{ data.report_items | selectattr("type", "equalto", "News by Sector") | list | length }} news item(s) for {{ available_sectors | length }} sector(s):</p>
    <ul>
        {% for sector in available_sectors %}
            <li><a href="#sect-{{ loop.index }}">{{ sector | e }}</a></li>
        {% endfor %}
    </ul>

    <p>If you have any questions or comments, please contact us.</p>

    <h1>News by sectors</h1>

    {% if (available_sectors | length) == 0 %}
        This week, there were no sector-relevant news items.
    {% endif %}

    {% for sector in available_sectors %}
        <a id="sect-{{ loop.index }}"></a><h2>Sector: {{ sector | e }}</h2>

        {% for report_item in data.report_items | selectattr("type", "equalto", "News by Sector") %}
            {% if report_item.attributes.nis_sector == sector %}
                <h3>{{ report_item.attributes.headline | e }}</h3>
                <table class="table table-bordered">
                    <tr class="table-row"><td>Date</td><td>{{ report_item.attributes.date | e }}</td></tr>
                    {% if report_item.attributes.date_updated is defined %}
                        <tr class="table-row"><td>Updated</td><td>{{ report_item.attributes.date_updated | e }}</td></tr>
                    {% endif %}
                    <tr class="table-row"><td>Report</td><td>{{ report_item.attributes.article | e }}</td></tr>
                </table>
            {% endif %}
        {% endfor %}

    {% endfor %}

    <h1>Vulnerabilities</h1>
    <div>

        {% for report_item in data.report_items %}
            {% if report_item.type == "Vulnerability Report" %}
                <a id="vuln-{{ loop.index }}"></a><h2>{{ report_item.name | e }}</h2>

                <table class="table table-bordered header_info" style="width: 100%">
                    <tr class="table-row">
                        <td class="w25 py-0">
                            <div class="mt-2 text-bold">Confidentiality</div>
                        </td>
                        <td class="w15 py-0">
                            <div class="mt-2">
                              <label class="checkbox-button">
                                <input type="checkbox" class="checkbox-button__input" id="low" name="low" {% if report_item.attributes.confidentiality == 'UNRESTRICTED' %}checked{% endif %}>
                                <span class="checkbox-button__control"></span>
                                <span class="checkbox-button__label">Unrestricted</span>
                              </label>
                            </div>
                        </td>
                        <td class="w15 py-0">
                            <div class="mt-2">
                              <label class="checkbox-button">
                                <input type="checkbox" class="checkbox-button__input" id="middle" name="middle" {% if report_item.attributes.confidentiality == 'CLASSIFIED' %}checked{% endif %}>
                                <span class="checkbox-button__control"></span>
                                <span class="checkbox-button__label">Classified</span>
                              </label>
                            </div>
                        </td>
                        <td class="w15 py-0">
                            <div class="mt-2">
                              <label class="checkbox-button">
                                <input type="checkbox" class="checkbox-button__input" id="high" name="high" {% if report_item.attributes.confidentiality == 'CONFIDENTIAL' %}checked{% endif %}>
                                <span class="checkbox-button__control"></span>
                                <span class="checkbox-button__label">Confidential</span>
                              </label>
                            </div>
                        </td>
                        <td class="w15 py-0">
                            <div class="mt-2">
                              <label class="checkbox-button">
                                <input type="checkbox" class="checkbox-button__input" id="critical" name="critical" {% if report_item.attributes.confidentiality == 'SECRET' %}checked{% endif %}>
                                <span class="checkbox-button__control"></span>
                                <span class="checkbox-button__label">Secret</span>
                              </label>
                            </div>
                        </td>
                        <td class="w15 py-0">
                            <div class="mt-2">
                              <label class="checkbox-button">
                                <input type="checkbox" class="checkbox-button__input" id="critical" name="critical" {% if report_item.attributes.confidentiality == 'TOP SECRET' %}checked{% endif %}>
                                <span class="checkbox-button__control"></span>
                                <span class="checkbox-button__label">Top Secret</span>
                              </label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="w25 py-0">
                            <div class="mt-2 text-bold">TLP</div>
                        </td>
                        <td class="mt-2" colspan="5">
                            {% if report_item.attributes.tlp == 'CLEAR' or report_item.attributes.tlp == 'WHITE' %}
                            <span style="padding: 4px; background-color: black !important; color:white; font-weight: 700">TLP:CLEAR</span>
                            {% endif %}
                            {% if report_item.attributes.tlp == 'GREEN' %}
                            <span style="padding: 4px; background-color: black !important; color:#33ff00; font-weight: 700">TLP:GREEN</span>
                            {% endif %}
                            {% if report_item.attributes.tlp == 'AMBER' %}
                            <span style="padding: 4px; background-color: black !important; color:#ffc000; font-weight: 700">TLP:AMBER</span>
                            {% endif %}
                            {% if report_item.attributes.tlp == 'AMBER+STRICT' %}
                            <span style="padding: 4px; background-color: black !important; color:#ffc000; font-weight: 700">TLP:AMBER+STRICT</span>
                            {% endif %}
                            {% if report_item.attributes.tlp == 'RED' %}
                            <span style="padding: 4px; background-color: black !important; color:#ff2b2b; font-weight: 700">TLP:RED</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="w25 py-0">
                            <div class="mt-2 text-bold">CVSS vector</div>
                        </td>
                        <td class="py-0" colspan="5">
                            <div class="mt-2"><span class="cvss">{{ report_item.attributes.cvss|e }} </span></div>
                        </td>
                    </tr>

                </table>

                <br>

                <table class="table table-bordered">
                    <tr>
                        <th class="th_data">DESCRIPTION</th>
                    </tr>
                    <tr>
                        <td class="text-justify text_in_tab">
                            {{ report_item.attributes.description|e }}
                        </td>
                    </tr>
                </table>

                <table class="table table-bordered">
                    <tr>
                        <th class="th_data">EXPOSURE DATE</th>
                    </tr>
                    <tr>
                        <td class="text-justify text_in_tab">
                            {{ report_item.attributes.exposure_date }}
                        </td>
                    </tr>
                </table>

                <table class="table table-bordered">
                    <tr>
                        <th class="th_data">UPDATE DATE</th>
                    </tr>
                    <tr>
                        <td class="text-justify text_in_tab">
                            {{ report_item.attributes.update_date }}
                        </td>
                    </tr>
                </table>

                <table class="table table-bordered">
                    <tr>
                        <th class="th_data">CVE</th>
                    </tr>
                    <tr>
                        <td class="text-justify text_in_tab">
                            {% if report_item.attributes.cve %}{{ report_item.attributes.cve[0]|e }}{% endif %}
                        </td>
                    </tr>
                </table>

                <table class="table table-bordered">
                    <tr>
                        <th class="th_data">IMPACT</th>
                    </tr>
                    <tr>
                        <td class="text-justify text_in_tab">
                            {% if report_item.attributes.impact %}{{ report_item.attributes.impact[0]|e }}{% endif %}
                        </td>
                    </tr>
                </table>

                <table class="table table-bordered">
                    <tr>
                        <th class="th_data">IOC</th>
                    </tr>
                    <tr>
                        <td class="text-justify text_in_tab">
                            {% if report_item.attributes.ioc %}{{ report_item.attributes.ioc[0]|e }}{% endif %}
                        </td>
                    </tr>
                </table>

                <table class="table table-bordered">
                    <tr>
                        <th class="th_data">AFFECTED SYSTEMS</th>
                    </tr>
                    <tr>
                        <td class="text-justify text_in_tab">
                            {% if report_item.attributes.affected_systems_cpe_codes %}
                                <!-- cpe can be stored also in two layer arrays -->
                                {% if report_item.attributes.affected_systems_cpe_codes[0] is iterable and report_item.attributes.affected_systems_cpe_codes[0] is not string %}
                                    {% for c in report_item.attributes.affected_systems_cpe_codes[0] %}
                                        {{ c | e }} <br>
                                    {% endfor %}
                                {% else %}
                                    {{ report_item.attributes.affected_systems_cpe_codes[0] | e }} <br>
                                {% endif %}
                            {% endif %}
                            {% if report_item.attributes.affected_systems %}{{ report_item.attributes.affected_systems | e }}{% endif %}
                        </td>
                    </tr>
                </table>

                <table class="table table-bordered">
                    <tr>
                        <th class="th_data">RECOMMENDATIONS</th>
                    </tr>
                    <tr>
                        <td class="text-justify text_in_tab">
                            {% if report_item.attributes.recommendations %}{{ report_item.attributes.recommendations|e }}{% endif %}
                        </td>
                    </tr>
                </table>

                <table class="table table-bordered">
                    <tr>
                        <th class="th_data">LINKS</th>
                    </tr>
                    <tr>
                        <td class="text-justify text_in_tab">
                            <ul class="list-unstyled">
                                {% if report_item.attributes.links %}
                                    {% for link in report_item.attributes.links %}
                                        <li><a href="{{ link }}">{{ link | e }}</a></li>
                                    {% endfor %}
                                {% endif %}
                            </ul>
                        </td>
                    </tr>
                </table>

            {% endif %}
        {% endfor %}

    </div>

    <div>
        <br>
        <table class="table table-borderless">
            <tr class="footer_text footer_color align-middle">
                <td class="w30 py-0 text-bold">Created by Taranis NG</td>
                <td class="w40 py-0 text-center info">Repo: <a href="https://github.com/SK-CERT/Taranis-NG/">github.com/SK-CERT/Taranis-NG</a></td>
                <td class="w30 py-0 text-right text-bold">Company name</td>
            </tr>
            <tr class="footer_text">
                <td class="w30 py-0">OSINT analysis tool</td>
                <td class="w40 py-0 text-center info">E-mail: sk-cert@nbu.gov.sk</td>
                <td class="w30 py-0 text-right">Company address</td>
            </tr>
            <tr class="footer_text">
                <td class="w30 py-0">for CSIRT community</td>
                <td class="w40 py-0 text-center info">Web: <a href="https://www.sk-cert.sk">www.sk-cert.sk</a></td>
                <td class="w30 py-0 text-right">City name</td>
            </tr>
        </table>
    </div>

</div>
</body>
</html>
