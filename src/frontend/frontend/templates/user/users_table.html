{% macro roles_count(item) %}
    {{ item.roles | length }}
{% endmacro %}

{% macro permissions_count(item) %}
    {{ item.permissions | length }}
{% endmacro %}

{% from "macros/table.html" import table, table_search_bar with context %}
{% from "macros/buttons.html" import import_button, export_button %}

{% set columns = [
    {'title': 'username', 'field': 'username', 'sortable': True, 'renderer': None},
    {'title': 'name', 'field': 'name', 'sortable': True, 'renderer': None},
    {'title': 'roles', 'field': 'roles', 'sortable': False, 'renderer': roles_count},
    {'title': 'permissions', 'field': 'permissions', 'sortable': False, 'renderer': permissions_count},
] %}

<div id="{{ model_name }}-table-container">
<div class="flex gap-4">
  <div class="grow-0">
      <button hx-get={{ url_for('admin.edit_user', user_id=0) }} hx-swap="innerHTML" hx-target="#form-container" class="btn btn-primary">
      New User
      </button>
  </div>
  {{ table_search_bar(model_name + '-table-container') }}
  <div class="grow-0">
      <div class="join gap-1" hx-target="#form-container">
      {{ import_button(url_for('admin.import_users')) }}
      {{ export_button(url_for('admin.export_users')) }}
      </div>
  </div>
</div>

{{ table(model_name + '-table', users, columns, url_for('admin.users')) }}
</div>
