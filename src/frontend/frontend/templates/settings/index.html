{% extends 'base.html' %}
{% block content %}
{% from "macros/variables.html" import tlp_levels %}

<div class="container mx-auto p-2" hx-boost="true">
  <!-- Header -->
  <div class="w-full px-2 mt-2">
    <h1 class="text-2xl font-bold">Admin Settings</h1>
  </div>

  <!-- Default TLP Level -->
  <div class="w-full px-2 mt-2">
    <div class="card bg-base-100 shadow-xl p-3">
      <div class="card-body">
        <h2 class="card-title">Default TLP Level</h2>
        <p>Set the default TLP Level for new Sources, Roles, and Reports.</p>
        <div class="card-actions">
          {{ tlp_levels(settings.default_tlp_level) }}
        </div>
      </div>
    </div>
  </div>

  <!-- Export Stories -->
  <div class="w-full px-2 mt-4">
    <div class="card bg-base-100 shadow-xl p-3">
      <div class="card-body">
        <h2 class="card-title">Export Stories</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2">
          <a
            href="{{ settings.export_story_url }}"
            class="btn btn-outline btn-block"
          >Export all Stories</a>
          <a
            href="{{ settings.export_story_url }}?metadata=true"
            class="btn btn-outline btn-block"
          >Export all Stories with metadata</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Danger Zone -->
  <div class="w-full px-2 mt-6">
    <div
      tabindex="0"
      class="collapse collapse-arrow border border-error bg-error/10 rounded-box"
    >
      <input type="checkbox" />
      <div class="collapse-title text-lg font-semibold text-error">
        <strong>Everything in this section is dangerous. You can break things. Be careful.</strong>
      </div>
      <div class="collapse-content p-0">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4">
          <!-- Clear Worker Queues -->
          <div>
            <div class="card bg-base-100 shadow">
              <div class="card-body">
                <h3 class="card-title">Clear all Worker Queues</h3>
                <p>Delete all messages from all worker queues. This action cannot be undone.</p>
                <div class="card-actions">
                  <button
                    class="btn btn-error btn-outline w-full"
                    hx-post="{{ settings.purge_queues_url }}"
                    hx-confirm="Are you sure you want to delete all worker queues?"
                  >Delete all Worker Queues</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Delete all Tags -->
          <div>
            <div class="card bg-base-100 shadow">
              <div class="card-body">
                <h3 class="card-title">Delete all Tags</h3>
                <p>Delete all tags from all Stories in the system. This action cannot be undone.</p>
                <div class="card-actions">
                  <button
                    class="btn btn-error btn-outline w-full"
                    hx-post="{{ settings.delete_tags_url }}"
                    hx-confirm="Are you sure you want to delete all tags?"
                  >Delete all Tags</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Ungroup all Stories -->
          <div>
            <div class="card bg-base-100 shadow">
              <div class="card-body">
                <h3 class="card-title">Ungroup all Stories</h3>
                <p>Ungroup all Stories in the system. This action cannot be undone.</p>
                <div class="card-actions">
                  <button
                    class="btn btn-error btn-outline w-full"
                    hx-post="{{ settings.ungroup_stories_url }}"
                    hx-confirm="Are you sure you want to ungroup all stories?"
                  >Ungroup all Stories</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Delete Everything -->
        <div class="p-4">
          <div class="card bg-base-100 shadow">
            <div class="card-body">
              <h3 class="card-title">Delete Everything</h3>
              <p>
                This may potentially fail and completely break the system.
                Tries to delete all Report Items, Products, News Items and Stories.
              </p>
              <div class="card-actions">
                <button
                  class="btn btn-error btn-outline w-full"
                  hx-post="{{ settings.delete_everything_url }}"
                  hx-confirm="Are you absolutely sure you want to delete EVERYTHING?"
                >Delete Everything</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
{% endblock %}
