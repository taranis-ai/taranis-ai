{% from "assess/story_card.html" import story_card with context %}
<div id="assess">
  {% set actions = actions | default([]) %}

  <div
    id="assess-container"
    class="p-4"
    @keyup.escape.window="clearSelection()"
    {# djlint:off #}
    x-data='{
      selectedItems: [],
      showHints: false,
      allIds: {{ story_ids | default([]) | tojson }},
      toggleSelection(id) {
        if (this.selectedItems.includes(id)) {
          this.selectedItems = this.selectedItems.filter(item => item !== id);
        } else {
          this.selectedItems = [...this.selectedItems, id];
        }
      },
      isSelected(id) {
        return this.selectedItems.includes(id);
      },
      clearSelection() {
        this.selectedItems = [];
      },
      selectAll() {
        if (!this.allIds.length) return;
        this.selectedItems = [...this.allIds];
      },
      action_vals(action, value) {
        if (!action && !value) return JSON.stringify({ story_ids: this.selectedItems });
        return JSON.stringify({ story_ids: this.selectedItems, action: action, value: value });
      }
    }'
    {# djlint:on #}
    >

    {% if stories %}
      {% include "assess/assess_top_bar.html" %}
      {% for story in stories %}{{ story_card(story) }}{% endfor %}
      <form method="get" class="flex justify-center mt-4">
        <div class="join">
          <button class="join-item btn {% if stories.page == stories.first_page %}btn-disabled{% endif %}">« Previous</button>
          <button class="join-item btn">Page {{ stories.page }}</button>
          <button class="join-item btn {% if stories.page == stories.last_page %}btn-disabled{% endif %}">» Next</button>
        </div>
      </form>
    {% else %}
      <p class="text-center text-base-content/60">No stories found.</p>
      <a href="{{ routes.base_route }}" class="btn btn-primary btn-sm w-full">
        {{ heroicon_outline('arrow-path', class='h-4 w-4') }}
        Reset filters
      </a>
    {% endif %}
  </div>
</div>
