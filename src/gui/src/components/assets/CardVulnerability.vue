<template>
  <v-container>
    <v-row>
      <v-col>
        <v-hover v-slot="{ hover }">
          <v-card :elevation="hover ? 12 : 2" @click.stop="cardItemToolbar">
            <!--CONTENT-->
            <v-layout :class="'status ' + itemStatus">
              <v-row>
                <v-col :style="UI.STYLE.card_tag">
                  <v-icon center>{{ itemStatusIcon }}</v-icon>
                </v-col>
                <v-col>
                  <div class="grey--text">{{ $t('generic.title') }}</div>
                  <span>{{ card.report_item.title }}</span>
                </v-col>
                <v-col>
                  <div class="grey--text">{{ $t('generic.created') }}</div>
                  <span>{{ card.report_item.created }}</span>
                </v-col>

                <!--HOVER TOOLBAR-->
                <v-col :style="UI.STYLE.card_hover_toolbar">
                  <v-row v-if="hover">
                    <v-col v-bind="UI.CARD.COL.TOOLS">
                      <v-btn icon @click.stop="cardItemToolbar('solve')">
                        <v-icon color="accent">{{ actionIcon }}</v-icon>
                      </v-btn>
                    </v-col>
                  </v-row>
                </v-col>
              </v-row>
            </v-layout>
          </v-card>
        </v-hover>
      </v-col>
    </v-row>
  </v-container>
</template>

<script>
import { solveVulnerability } from '@/api/assets'

export default {
  name: 'CardVulnerability',
  props: {
    card: {
      type: Object,
      required: true
    },
    asset: {
      type: Object,
      required: true
    }
  },
  emits: ['solve-card'],
  data: () => ({
    toolbar: false
  }),
  computed: {
    itemStatus() {
      if (this.card.solved) {
        return 'completed'
      } else {
        return 'alert'
      }
    },
    itemStatusIcon() {
      if (this.card.solved) {
        return 'mdi-check-circle-outline'
      } else {
        return 'mdi-alert-outline'
      }
    },
    actionIcon() {
      if (this.card.solved) {
        return 'mdi-alert-circle-outline'
      } else {
        return 'mdi-checkbox-marked-circle-outline'
      }
    }
  },
  methods: {
    itemClicked(data) {
      //this.$root.$emit('show-vulnerability-detail', data.report_item)
      console.debug('itemClicked', data)
    },
    solveClicked() {
      solveVulnerability({
        asset_id: this.asset.id,
        report_item_id: this.card.report_item.id,
        solved: !this.card.solved
      }).then(() => {
        this.$emit('solve-card', this.card)
      })
    },
    cardItemToolbar(action) {
      switch (action) {
        case 'solve':
          this.solveClicked()
          break

        default:
          this.toolbar = false
          this.itemClicked(this.card)
          break
      }
    }
  }
}
</script>
